<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Library Management - Book Details</title>
    <link href="static/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/styles.css">
    <style>
        body {
            background-color: #f8f9fa;
            /* font-family: 'Arial', sans-serif; */
        }

        .main.container-fluid {
            background-color: #e9ecef;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0.75rem 1.5rem rgba(0, 0, 0, 0.2);
        }

        .navbar-brand,
        .nav-link.text-white {
            color: white !important;
        }

        .book-detail-card {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.25);
            padding: 30px;
            margin-top: 30px;
            position: relative;
        }

        .book-detail-card h2 {
            background-color: rgba(255, 255, 204, 0.5);
            padding: 15px;
            margin-bottom: 0;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            margin-left: -30px;
            margin-right: -30px;
        }

        .book-detail-card hr {
            border-top: 2px solid #ddd;
            margin-top: 0;
            margin-bottom: 30px;
        }

        .book-cover-col {
            text-align: center;
        }

        .book-cover {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 0.3rem 0.7rem rgba(0, 0, 0, 0.15);
            max-height: 350px;
        }

        .book-detail-row {
            margin-bottom: 20px;
            font-size: 1.2rem;
            line-height: 1.6;
        }

        .book-detail-label {
            font-weight: bold;
            margin-right: 20px;
            min-width: 150px;
            display: inline-block;
        }

        .book-detail-value {
            /*font-family: 'Georgia', serif;*/
            font-size: 1.2rem;
        }

        .book-cover-placeholder {
            background-color: #f0f0f0;
            border-radius: 10px;
            box-shadow: 0 0.3rem 0.7rem rgba(0, 0, 0, 0.15);
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            height: 350px;
            font-size: 1.5rem;
            color: #777;
        }

        .back-button {
            /* position: absolute; REMOVED ABSOLUTE POSITIONING */
            /* bottom: 20px;    REMOVED ABSOLUTE POSITIONING */
            /* right: 20px;     REMOVED ABSOLUTE POSITIONING */
            margin-left: 10px; /* Added left margin to separate from Delete button */
        }

        .delete-button { /* Style for delete button */
            /* position: absolute; REMOVED ABSOLUTE POSITIONING */
            /* bottom: 20px;    REMOVED ABSOLUTE POSITIONING */
            /* left: 20px;      REMOVED ABSOLUTE POSITIONING */
            margin-right: 10px; /* Added right margin to separate from Back button */
        }

        .action-buttons { /* Container for action buttons to align them */
            text-align: right; /* Align buttons to the right */
            margin-top: 20px;
            display: flex; /* Use flexbox to align buttons horizontally */
            justify-content: flex-end; /* Align items to the right end of the container */
            padding-right: 10px; /* Add some right padding for visual spacing from card edge */
            padding-bottom: 10px; /* Add some bottom padding for visual spacing from card bottom */
        }

        .action-buttons .btn { /* Style for buttons within action-buttons container */
            margin-bottom: 0; /* Remove default bottom margin from buttons */
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-danger ">
        <a class="navbar-brand text-white" href="index.html">Library Management</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item"><a class="nav-link text-white" href="Student.html">Students</a></li>
                <li class="nav-item"><a class="nav-link text-white" href="books.html">Books</a></li>
                <li class="nav-item"><a class="nav-link text-white" href="borrow.html">Borrow Books</a></li>
                <li class="nav-item"><a class="nav-link text-white" href="return.html">Return Books</a></li>
                <li class="nav-item"><a class="nav-link text-white" href="contact.html">Contact</a></li>
            </ul>
        </div>
    </nav>

    <div class="main container-fluid">
        <div class="row mt-4">
            <div class="col-md-10 offset-md-1">
                <div class="book-detail-card">
                    <h2 class="text-center mb-4">Book Details</h2>
                    <hr>
                    <div class="row">
                        <div class="col-md-4 book-cover-col">
                            <img src="" alt="Book Cover" class="book-cover" id="bookCoverImage">
                            <div class="book-cover-placeholder" id="bookCoverPlaceholder" style="display:none;">No Photo</div>
                        </div>
                        <div class="col-md-8">
                            <div class="book-detail-row">
                                <span class="book-detail-label">Book Name:</span><span id="bookName" class="book-detail-value"></span>
                            </div>
                            <div class="book-detail-row">
                                <span class="book-detail-label">Book Number:</span><span id="bookNumber" class="book-detail-value"></span>
                            </div>
                            <div class="book-detail-row">
                                <span class="book-detail-label">Author:</span><span id="bookAuthor" class="book-detail-value"></span>
                            </div>
                            <div class="book-detail-row">
                                <span class="book-detail-label">Category:</span><span id="bookCategory" class="book-detail-value"></span>
                            </div>
                            <div class="book-detail-row">
                                <span class="book-detail-label">Location:</span><span id="bookLocation" class="book-detail-value"></span>
                            </div>
                            <div class="book-detail-row">
                                <span class="book-detail-label">Availability:</span><span id="bookAvailability" class="book-detail-value"></span>
                            </div>
                            <div class="book-detail-row">
                                <span class="book-detail-label">Available Date:</span><span id="bookAvailableDate" class="book-detail-value"></span>
                            </div>
                        </div>
                    </div>
                    <div class="action-buttons"> <!- - Container for action buttons -->
                        <button class="btn btn-danger delete-button" id="deleteBookBtn">Delete Book</button>
                        <a href="books.html" class="btn btn-secondary back-button">Back to Books</a>
                    </div>
                    <p id="deleteBookStatus" class="mt-3 text-center"></p> <!- - Status message area -->
                </div>
            </div>
        </div>
    </div>

    <script src="static/js/jquery.js"></script>
    <script src="static/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function () {
            const urlParams = new URLSearchParams(window.location.search);
            const bookNumber = urlParams.get('bookNumber');

            if (bookNumber) {
                fetch(`/api/book-details/${bookNumber}`)
                    .then(response => response.json())
                    .then(book => {
                        if (book) {
                            $('#bookName').text(book.book_name);
                            $('#bookNumber').text(book.book_number);
                            $('#bookAuthor').text(book.author || 'N/A');
                            $('#bookCategory').text(book.category || 'N/A');
                            $('#bookLocation').text(book.location || 'N/A');
                            $('#bookAvailability').text(book.is_available);
                            $('#bookAvailableDate').text(book.available_date || 'N/A');

                            if (book.book_photo_path) {
                                $('#bookCoverImage').attr('src', book.book_photo_path).show();
                                $('#bookCoverPlaceholder').hide();
                            } else {
                                $('#bookCoverImage').hide();
                                $('#bookCoverPlaceholder').show();
                            }
                        } else {
                            $('.book-detail-card').html('<p class="text-center">Book details not found.</p>');
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching book details:', error);
                        $('.book-detail-card').html('<p class="text-center text-danger">Error loading book details.</p>');
                    });
            } else {
                $('.book-detail-card').html('<p class="text-center">No book number provided.</p>');
            }

            // --- Delete Book Functionality ---
            $('#deleteBookBtn').click(function() {
                if (confirm(`Are you sure you want to delete book number ${bookNumber}: "${$('#bookName').text()}"? This action cannot be undone.`)) {
                    $.ajax({
                        url: `/api/delete-book/${bookNumber}`,
                        type: 'DELETE',
                        success: function(response) {
                            $("#deleteBookStatus").text(response).removeClass("text-danger").addClass("text-success");
                            // Redirect to books page after successful deletion
                            setTimeout(function() { window.location.href = 'books.html'; }, 1500); // Redirect after 1.5 seconds
                        },
                        error: function(xhr, status, error) {
                            console.error("Error deleting book:", error);
                            $("#deleteBookStatus").text("Error deleting book.").removeClass("text-success").addClass("text-danger");
                        }
                    });
                } else {
                    $("#deleteBookStatus").text("Delete cancelled.").removeClass("text-success").addClass("text-info"); // Optional: Inform user that deletion was cancelled
                }
            });
        });
    </script>
</body>

</html>